---
- name: Start OpenCanary honeypot
  hosts: localhost

  tasks:
  - name: Include variables
    include_vars: "{{ item }}"
    loop:
      - ../secrets/mail_secret.yml
      - ../vars/user.yml

  - name: Create /etc/opencanary directory
    file:
      path: /etc/opencanaryd
      state: directory
      mode: "0755"

  - name: Generate a OpenCanary conf file
    template:
      src: ../opencanary.conf.j2
      dest: /etc/opencanaryd/opencanary.conf
      owner: honey
      group: honey
      mode: "0644"

  - name: Start OpenCanary daemon
    script:
      cmd: ../helper_scripts/activate.sh "{{ user }}"

